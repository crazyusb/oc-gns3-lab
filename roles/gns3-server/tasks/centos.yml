---
 - name: Setup EPEL repo
   yum:
       name: epel-release
   when: ansible_distribution_major_version == "7"

 - name: Install tools and dep
   yum:
     name: "{{ packages }}"
   vars:
     packages:
          - gcc
          - python3-devel
          - python3-pip
          - python36-psutil
   when: ansible_distribution_major_version == "7"

 - name: Setup EPEL repo
   dnf:
       name: epel-release
   when: ansible_distribution_major_version == "8"

 - name: Install tools and dep
   dnf:
     name: "{{ packages }}"
   vars:
     packages:
          - gcc
          - python3-devel
          - python3-pip
          - python3-psutil
   when: ansible_distribution_major_version == "8"

 - name: Install PyPiP
   dnf:
       name: python3-pip
   when: ansible_distribution_major_version == "8"

 - name: Create GNS3 group
   group: 
    name: gns3
    state: present

 - name: Create GNS3 users
   user:
    name: gns3
    group: gns3
    groups: ubridge, libvirt, kvm
    comment: gns3 user

 - include: gns3-docker-centos.yml
   when: (docker == "true" ansible_distribution == "CentOS" or ansible_distribution == "RedHat")

 - name: GNS3-server
   pip:
    name: gns3-server==2.2.5
    executable: pip3

 - name: Systemd file
   copy:
      src: "{{ role_path }}/files/lib/systemd/system/gns3.service"
      dest: /lib/systemd/system/gns3.service

 - name: Enable gns3
   systemd:
    name: gns3
    state: started
    enabled: yes
